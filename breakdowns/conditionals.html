<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<title>Ruby LLVM Script by tophat</title>
<link rel="stylesheet" href="http://tophat.github.com/ruby-llvm-script/stylesheets/styles.css">
<link rel="stylesheet" href="http://tophat.github.com/ruby-llvm-script/stylesheets/pygment_trac.css">
<script src="http://tophat.github.com/ruby-llvm-script/javascripts/scale.fix.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="wrapper">
      <header><h1>Ruby LLVM Script</h1>
        <p>Simple, clean interface for ruby-llvm.</p>
        <p class="view"><a href="https://github.com/tophat/ruby-llvm-script">View the Project on GitHub <small>tophat/ruby-llvm-script</small></a></p>
        <ul>
<li><a href="https://github.com/tophat/ruby-llvm-script/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/tophat/ruby-llvm-script/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/tophat/ruby-llvm-script">View On <strong>GitHub</strong></a></li>
        </ul></header><section><h1>Conditionals</h1>
<p>This page will analyze the example program <code>cond.rb</code> from the samples directory. <code>cond.rb</code> shows how conditionals are done in ruby-llvm-script.</p>

<h3>Source</h3>

<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'llvm/script'</span>
<span class="nb">require</span> <span class="s1">'llvm/script/kernel'</span>

<span class="no">FILE</span> <span class="o">=</span> <span class="no">LLVM</span><span class="o">::</span><span class="no">Struct</span><span class="p">(</span><span class="s2">"FILE"</span><span class="p">)</span>
<span class="no">FILEPTR</span> <span class="o">=</span> <span class="no">FILE</span><span class="o">.</span><span class="n">pointer</span>

<span class="n">program</span> <span class="s2">"Conditionals"</span> <span class="k">do</span>
  <span class="n">extern</span> <span class="ss">:atoi</span><span class="p">,</span> <span class="o">[</span><span class="no">CHARPTR</span><span class="o">]</span><span class="p">,</span> <span class="no">INT</span>
  <span class="n">extern</span> <span class="ss">:printf</span><span class="p">,</span> <span class="o">[</span><span class="no">CHARPTR</span><span class="p">,</span> <span class="no">VARARGS</span><span class="o">]</span><span class="p">,</span> <span class="no">INT</span>
  <span class="n">extern</span> <span class="ss">:fdopen</span><span class="p">,</span> <span class="o">[</span><span class="no">INT</span><span class="p">,</span> <span class="no">CHARPTR</span><span class="o">]</span><span class="p">,</span> <span class="no">FILEPTR</span>
  <span class="n">extern</span> <span class="ss">:fgets</span><span class="p">,</span> <span class="o">[</span><span class="no">CHARPTR</span><span class="p">,</span> <span class="no">INT</span><span class="p">,</span> <span class="no">FILEPTR</span><span class="o">]</span><span class="p">,</span> <span class="no">CHARPTR</span>
	
  <span class="n">main</span> <span class="k">do</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">alloca</span><span class="p">(</span><span class="no">CHAR</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">stdin</span> <span class="o">=</span> <span class="n">fdopen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span>
    <span class="nb">printf</span><span class="p">(</span><span class="s2">"Please input a non-zero number: "</span><span class="p">)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">stdin</span><span class="p">))</span>
    <span class="n">cond</span> <span class="n">opr</span><span class="p">(</span><span class="ss">:eq</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">proc</span> <span class="p">{</span>
      <span class="nb">printf</span><span class="p">(</span><span class="s2">"You entered a zero! Bad boy!</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="p">},</span> <span class="nb">proc</span> <span class="p">{</span>
      <span class="nb">printf</span><span class="p">(</span><span class="s2">"You entered %d, which is not 0! Good boy!</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">sret</span> <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">puts</span>
<span class="n">program</span><span class="o">.</span><span class="n">dump</span>

<span class="nb">puts</span>
<span class="n">program</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">"cond"</span><span class="p">)</span>
</pre>
</div>


<h3>Breakdown</h3>

<p>Much of this example has been covered in <a href="http://tophat.github.com/ruby-llvm-script/breakdowns/io.html">IO</a>. So, we will only discuss the new <code>atoi</code> function and <code>cond</code> in more depth.</p>

<div class="highlight">
<pre><span class="n">extern</span> <span class="ss">:atoi</span><span class="p">,</span> <span class="o">[</span><span class="no">CHARPTR</span><span class="o">]</span><span class="p">,</span> <span class="no">INT</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="n">num</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="n">stdin</span><span class="p">))</span>
</pre>
</div>


<p>The <a href="http://www.cplusplus.com/reference/clibrary/cstdlib/atoi/">atoi</a> function returns the integer value of a string (similar to the ruby <a href="http://www.ruby-doc.org/core-1.8.7/String.html#method-i-to_i">String#to_i</a> method). If the string does not contain an integer (ex. "some text") it returns 0. In this case, it converts the input returned by <code>fgets</code> (i.e. <code>buf</code>) into a integer.</p>

<div class="highlight">
<pre><span class="n">cond</span> <span class="n">opr</span><span class="p">(</span><span class="ss">:eq</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">proc</span> <span class="p">{</span>
  <span class="nb">printf</span><span class="p">(</span><span class="s2">"You entered a zero! Bad boy!</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="p">},</span> <span class="nb">proc</span> <span class="p">{</span>
  <span class="nb">printf</span><span class="p">(</span><span class="s2">"You entered %d, which is not 0! Good boy!</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
<span class="p">}</span>
</pre>
</div>


<p>In the <a href="http://tophat.github.com/ruby-llvm-script/breakdowns/io.html">IO</a> example, the <code>cond</code> statement took a block (which acted as first proc) and executed that if the first argument returned 1 (the LLVM equivalent of true). If the first argument returned 0 (the LLVM equivalent of false), it just skipped the block. That was the ruby-llvm-script version of an if statement. This version, however, is the ruby-llvm-script equivalent of an if/else statement. Here, if the first argument returns 0, the second proc is executed instead of just moving on. </p>

<p>So, in this case, if <code>num</code> is 0 it prints out: <code>"You entered a zero! Bad boy!"</code> followed by a newline ("\n"). If <code>num</code> is not 0 it prints out: <code>"You entered %d, which is not 0! Good boy!"</code> followed by a newline and with "%d" being replaced by the value of <code>num</code>. </p></section>
</div>
    <footer><p>Project maintained by <a href="https://github.com/tophat">tophat</a></p>
      <p>Hosted on GitHub Pages â€” Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer><!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
</body>
</html>
